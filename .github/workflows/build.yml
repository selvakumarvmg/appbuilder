name: Build Python Desktop App with Debug and Docker (Ubuntu 20.04)

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show runner info for debugging
        run: |
          echo "Runner OS:"
          uname -a
          echo "glibc version:"
          ldd --version | head -n1

      - name: Build app inside Ubuntu 20.04 Docker container
        run: |
          docker run --rm -v $PWD:/app -w /app ubuntu:20.04 /bin/bash -c "
            apt-get update && apt-get install -y python3 python3-pip python3-venv build-essential wget
            python3 -m pip install --upgrade pip
            python3 -m pip install pyinstaller PySide6 requests
            # Show python info inside container for debug
            python3 --version
            python3 -m pip --version
            python3 -m pip list
            # Run PyInstaller with debug logs
            python3 -m PyInstaller --noconfirm --windowed --onefile --icon=pm.png --name=PremediaApp --log-level=DEBUG app.py
            # List dist folder to verify output
            ls -l dist/
          "

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: PremediaApp-build
          path: dist/PremediaApp
